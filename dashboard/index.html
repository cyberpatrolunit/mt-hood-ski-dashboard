<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLAWUNiT // SYSTEM MONITOR</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --neon-cyan: #00ffff;
      --blood-orange: #ff4500;
      --gold-accent: #ffd700;
      --dark-bg: #000810;
    }

    body {
      font-family: 'Orbitron', monospace;
      background: var(--dark-bg);
      color: var(--neon-cyan);
      min-height: 100vh;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 3px;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
    }

    /* Tile Grid */
    .tile-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 12px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Tile */
    .tile {
      aspect-ratio: 1;
      background: rgba(0, 8, 16, 0.9);
      border: 1px solid rgba(0, 255, 255, 0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.15s;
      padding: 12px;
    }

    .tile:hover {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
      transform: scale(1.05);
    }

    .tile-icon {
      width: 28px;
      height: 28px;
      stroke: var(--neon-cyan);
      margin-bottom: 8px;
    }

    .tile-value {
      font-size: 16px;
      font-weight: 900;
      color: var(--gold-accent);
      text-shadow: 0 0 8px var(--gold-accent);
      line-height: 1;
    }

    .tile-label {
      font-size: 7px;
      color: rgba(0, 255, 255, 0.6);
      margin-top: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 8, 16, 0.98);
      z-index: 9999;
      padding: 40px 20px;
      overflow-y: auto;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.2s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal-content {
      background: rgba(0, 8, 16, 0.95);
      border: 2px solid var(--blood-orange);
      box-shadow: 0 0 30px rgba(255, 69, 0, 0.5), inset 0 0 40px rgba(255, 69, 0, 0.1);
      padding: 40px;
      max-width: 600px;
      width: 100%;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 32px;
      color: var(--blood-orange);
      cursor: pointer;
      line-height: 1;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .modal-close:hover {
      opacity: 1;
    }

    .modal h2 {
      color: var(--blood-orange);
      text-shadow: 0 0 15px rgba(255, 69, 0, 0.8);
      font-size: 24px;
      margin-bottom: 30px;
      letter-spacing: 2px;
    }

    .modal-stat {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 69, 0, 0.2);
    }

    .modal-label {
      font-size: 11px;
      color: rgba(255, 69, 0, 0.7);
      text-transform: uppercase;
    }

    .modal-value {
      font-size: 20px;
      font-weight: 900;
      color: var(--gold-accent);
      text-shadow: 0 0 10px var(--gold-accent);
    }

    .chart-container {
      height: 200px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>CLAWUNiT</h1>
  </header>

  <div class="tile-grid">
    <!-- CPU Tile -->
    <div class="tile" onclick="openModal('cpu')">
      <svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
        <rect x="4" y="4" width="16" height="16" rx="2"/>
        <rect x="9" y="9" width="6" height="6"/>
        <line x1="4" y1="12" x2="2" y2="12"/>
        <line x1="22" y1="12" x2="20" y2="12"/>
      </svg>
      <div class="tile-value" id="cpu-tile">--</div>
      <div class="tile-label">CPU</div>
    </div>

    <!-- Memory Tile -->
    <div class="tile" onclick="openModal('mem')">
      <svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
        <rect x="4" y="4" width="16" height="16"/>
        <line x1="4" y1="9" x2="20" y2="9"/>
        <line x1="4" y1="14" x2="20" y2="14"/>
      </svg>
      <div class="tile-value" id="mem-tile">--</div>
      <div class="tile-label">MEM</div>
    </div>

    <!-- Disk Tile -->
    <div class="tile" onclick="openModal('disk')">
      <svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
        <circle cx="12" cy="12" r="8"/>
        <circle cx="12" cy="12" r="4"/>
      </svg>
      <div class="tile-value" id="disk-tile">--</div>
      <div class="tile-label">DISK</div>
    </div>

    <!-- Network Tile -->
    <div class="tile" onclick="openModal('net')">
      <svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M2 12h20M12 2a15 15 0 0 1 0 20 15 15 0 0 1 0-20"/>
      </svg>
      <div class="tile-value" id="net-tile">--</div>
      <div class="tile-label">NET</div>
    </div>

    <!-- I/O Tile -->
    <div class="tile" onclick="openModal('io')">
      <svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
        <polyline points="16 3 21 8 16 13"/>
        <line x1="10" y1="8" x2="21" y2="8"/>
        <polyline points="8 11 3 16 8 21"/>
        <line x1="14" y1="16" x2="3" y2="16"/>
      </svg>
      <div class="tile-value" id="io-tile">--</div>
      <div class="tile-label">I/O</div>
    </div>

    <!-- Neural Tile -->
    <div class="tile" onclick="openModal('neural')">
      <svg class="tile-icon" viewBox="0 0 24 24" fill="none" stroke-width="2">
        <circle cx="12" cy="12" r="8"/>
        <circle cx="8" cy="10" r="1.5" fill="currentColor"/>
        <circle cx="16" cy="10" r="1.5" fill="currentColor"/>
      </svg>
      <div class="tile-value" id="neural-tile">--</div>
      <div class="tile-label">NEURAL</div>
    </div>
  </div>

  <!-- CPU Modal -->
  <div id="cpu-modal" class="modal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal()">×</div>
      <h2>CPU CORE</h2>
      <div class="modal-stat">
        <span class="modal-label">CPU</span>
        <span class="modal-value" id="cpu-full">--</span>
      </div>
      <div class="chart-container"><canvas id="cpu-chart"></canvas></div>
    </div>
  </div>

  <!-- Memory Modal -->
  <div id="mem-modal" class="modal">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal()">×</div>
      <h2>MEMORY</h2>
      <div class="modal-stat">
        <span class="modal-label">USAGE</span>
        <span class="modal-value" id="mem-full">--</span>
      </div>
      <div class="chart-container"><canvas id="mem-chart"></canvas></div>
    </div>
  </div>

  <!-- Other modals similarly... -->

  <script>
    let activeModal = null;

    function openModal(id) {
      closeModal();
      const modal = document.getElementById(id + '-modal');
      if (modal) {
        modal.classList.add('active');
        activeModal = modal;
      }
    }

    function closeModal() {
      if (activeModal) {
        activeModal.classList.remove('active');
        activeModal = null;
      }
    }

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeModal();
    });

    // 60Hz Update Loop
    let lastUpdateTime = 0;
    const UPDATE_INTERVAL = 1000 / 60; // 60Hz

    async function fetchStats() {
      try {
        const res = await fetch('/api/stats');
        const data = await res.json();
        return data;
      } catch (e) {
        return null;
      }
    }

    async function fetchRealtime() {
      try {
        const res = await fetch('/api/realtime');
        const data = await res.json();
        return data;
      } catch (e) {
        return null;
      }
    }

    function update60Hz(timestamp) {
      if (timestamp - lastUpdateTime >= UPDATE_INTERVAL) {
        updateTiles();
        lastUpdateTime = timestamp;
      }
      requestAnimationFrame(update60Hz);
    }

    async function updateTiles() {
      const stats = await fetchStats();
      const rt = await fetchRealtime();
      
      if (stats) {
        const cpuTotal = stats.cpu.user + stats.cpu.system;
        document.getElementById('cpu-tile').textContent = cpuTotal.toFixed(0);
        document.getElementById('cpu-full').textContent = cpuTotal.toFixed(1) + '%';
        
        const memFree = parseFloat(stats.memory.free || '0');
        const memActive = parseFloat(stats.memory.active || '0');
        const memTotal = memFree + memActive;
        const memPercent = memTotal > 0 ? ((memActive / memTotal) * 100) : 0;
        document.getElementById('mem-tile').textContent = memPercent.toFixed(0);
        document.getElementById('mem-full').textContent = memPercent.toFixed(1) + '%';
        
        const diskPercent = parseFloat(stats.disk.percent);
        document.getElementById('disk-tile').textContent = diskPercent.toFixed(0);
      }

      if (rt) {
        const netTotal = (rt.network.rxRate + rt.network.txRate).toFixed(0);
        document.getElementById('net-tile').textContent = netTotal;
        
        const ioTotal = (parseFloat(rt.disk.readKBps) + parseFloat(rt.disk.writeKBps)).toFixed(0);
        document.getElementById('io-tile').textContent = ioTotal;
      }
    }

    // Start
    updateTiles();
    requestAnimationFrame(update60Hz);
    setInterval(updateTiles, 1000);
  </script>
</body>
</html>
